---
import BaseHead from '../../components/BaseHead.astro'
import Header from '../../components/Header.astro'
import Footer from '../../components/Footer.astro'
import { SITE_DESCRIPTION } from '../../consts'
import { getCollection } from 'astro:content'
import FormattedDate from '../../components/FormattedDate.astro'
import { FaCalendar, FaShuffle } from 'react-icons/fa6'
import Backdrop from '@/components/Backdrop.astro'
import { Image } from 'astro:assets'
import Aurora from '../../components/Aurora.astro'

function shuffleArray<Type>(arr: Type[]): Type[] {
  for (let i = 0; i < arr.length; i++) {
    const j = Math.floor(Math.random() * (i + 1))
    ;[arr[i], arr[j]] = [arr[j], arr[i]]
  }

  return arr
}

const posts = shuffleArray(
  (await getCollection('blog')).filter((post) => !post.data.draft)
)
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title="Blog" description={SITE_DESCRIPTION} />
  </head>
  <body class="bg-background text-foreground antialiased">
    <Backdrop />
    <Header />
    <main class="container">
      <section class="flex flex-col">
        <div>
          <Aurora class="flex justify-between items-end">
            <h1
              class="leading-tight text-8xl font-bold animate-in fade-in slide-in-from-bottom-2 fill-mode-both duration-1000"
            >
              Blog
            </h1>
            <small class="flex items-center gap-2">
              <FaShuffle size={1} />
              <span>Posts are randomized and not sorted by date.</span>
            </small>
          </Aurora>
        </div>
        <div class="md:columns-2 lg:columns-3 gap-4">
          {
            posts.map((post) => (
              <div class="mb-6">
                <a
                  href={`/blog/${post.slug}`}
                  class="flex flex-col gap-4 p-6 border rounded-lg break-inside-avoid-column bg-background/60 backdrop-opacity-60 shadow-lg"
                >
                  <div>
                    {post.data.heroImage && (
                      <Image
                        width={1024}
                        height={360}
                        src={post.data.heroImage}
                        alt={`${post.data.title} hero image`}
                      />
                    )}
                  </div>
                  <div class="animate-in fill-mode-both fade-in slide-in-from-bottom-1 duration-500">
                    <h4 class="inline-block py-1 text-2xl font-semibold">
                      {post.data.title}
                    </h4>
                    <div>
                      <div class="inline-flex gap-2 items-center rounded bg-violet-100 dark:bg-violet-900 text-violet-900 dark:text-violet-200 px-2 py-1 text-xs animate-in fill-mode-both fade-in slide-in-from-bottom-1 duration-500 delay-150">
                        <FaCalendar />
                        <FormattedDate date={post.data.pubDate} />
                      </div>
                    </div>
                  </div>
                  <div class="prose animate-in fill-mode-both fade-in slide-in-from-bottom-1 duration-500 delay-300 text-gray-800 dark:text-gray-200">
                    <p>{post.data.description}</p>
                  </div>
                </a>
              </div>
            ))
          }
        </div>
      </section>
    </main>
    <Footer />
  </body>
</html>
