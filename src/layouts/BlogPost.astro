---
import { type CollectionEntry } from 'astro:content'
import { Image } from 'astro:assets'
import BaseHead from '@/components/BaseHead.astro'
import Header from '@/components/Header.astro'
import Footer from '@/components/Footer.astro'
import FormattedDate from '@/components/FormattedDate.astro'
import { FaArrowLeft } from 'react-icons/fa6'
import BlockAuthor from '../components/BlockAuthor.astro'

type Props = CollectionEntry<'blog'>['data']

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  heroImageOptimized,
  fullImage,
  tags,
} = Astro.props
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
  </head>

  <body
    class="bg-background text-foreground antialiased selection:bg-primary selection:text-background"
  >
    <div class="noise-overlay"></div>
    <Header />
    <main class="container py-12 lg:py-20">
      <article>
        <div class="flex flex-col gap-12">
          <!-- Header Section -->
          <div
            class="flex flex-col gap-8 border-b border-foreground/10 pb-12 relative"
          >
            <div
              class="absolute -top-8 left-0 font-mono text-xs tracking-widest text-foreground/40 select-none"
            >
              FIG 2.1 // ENTRY
            </div>
            <div class="flex flex-col gap-6">
              <a
                href="/blog"
                class="w-fit flex gap-2 items-center font-mono text-xs tracking-widest text-primary/70 hover:text-primary transition-colors no-underline"
              >
                <FaArrowLeft /><span>Back to Index</span>
              </a>

              <h1
                class="font-serif text-5xl lg:text-7xl leading-none text-foreground"
              >
                {title}
              </h1>
            </div>

            <div
              class="flex flex-wrap items-center gap-6 font-mono text-xs tracking-widest text-foreground/60"
            >
              {
                pubDate && (
                  <div class="flex items-center gap-2">
                    <span class="text-primary">Date:</span>
                    <FormattedDate date={pubDate} />
                  </div>
                )
              }
              {
                updatedDate && (
                  <div class="flex items-center gap-2">
                    <span class="text-primary">Updated:</span>
                    <FormattedDate date={updatedDate} />
                  </div>
                )
              }
            </div>
          </div>

          <div class="grid lg:grid-cols-12 gap-12 lg:gap-24">
            <!-- Main Content -->
            <section
              class="lg:col-span-8 prose prose-lg max-w-none prose-headings:font-serif prose-headings:font-normal prose-a:text-primary prose-a:no-underline hover:prose-a:text-primary/80 prose-blockquote:border-l-primary prose-img:border-2 prose-img:border-foreground/10"
            >
              {
                (heroImageOptimized || heroImage) && (
                  <div class="mb-12 not-prose flex flex-col gap-4">
                    <div class="border-2 border-foreground/10 p-2 bg-secondary">
                      <Image
                        class="w-full h-auto grayscale contrast-125 hover:grayscale-0 transition-all duration-700"
                        src={heroImageOptimized || heroImage}
                        width={1280}
                        height={720}
                        alt={`${title} Hero Image`}
                      />
                    </div>
                    {fullImage && (
                      <div class="flex justify-end">
                        <a
                          href={fullImage}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="font-mono text-[10px] tracking-[0.2em] uppercase text-foreground/40 hover:text-primary transition-colors flex items-center gap-2 group"
                        >
                          <span class="w-8 h-[1px] bg-foreground/20 group-hover:bg-primary/40 transition-colors" />
                          Full Scale // Download Schematic
                        </a>
                      </div>
                    )}
                  </div>
                )
              }
              <slot />
            </section>

            <!-- Sidebar -->
            <aside
              class="lg:col-span-4 flex flex-col gap-12 h-fit lg:sticky lg:top-32"
            >
              <div
                class="border-l-2 border-foreground/10 pl-6 flex flex-col gap-8"
              >
                <div>
                  <span
                    class="font-mono text-xs tracking-widest text-primary block mb-4"
                    >Author</span
                  >
                  <BlockAuthor />
                </div>

                {
                  tags && tags.length > 0 && (
                    <div>
                      <span class="font-mono text-xs tracking-widest text-primary block mb-4">
                        Tags
                      </span>
                      <div class="flex flex-wrap gap-2">
                        {tags.map((tag) => {
                          const tagId = typeof tag === 'object' ? tag.id : tag
                          return (
                            <a
                              href={`/tags/${tagId}`}
                              class="font-mono text-xs border border-foreground/20 px-3 py-1 hover:bg-primary hover:text-background hover:border-primary transition-colors no-underline rounded-full"
                            >
                              {tagId}
                            </a>
                          )
                        })}
                      </div>
                    </div>
                  )
                }
              </div>
            </aside>
          </div>
        </div>
      </article>
    </main>
    <Footer />
  </body>
</html>
